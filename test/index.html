<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>VisibilityAnalysisAndP2P</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="">
    <style>
    </style>
    <script src="http://youku3d.com/smart3d/lib/socket.io.js"></script>
    <script src="http://youku3d.com/smart3d/lib/adapter.js"></script>
    <script>
        const renderURL="42.192.188.161:8119"
        const socketURL=location.host
        const getPreParam=id=>{
            id=id+"="
            return window.location.search.split(id).length>1?
                    window.location.search.split(id)[1].split("&")[0]:
                    null
        }
        const socket = io.connect(socketURL,{transports:['websocket','xhr-polling','jsonp-polling']})
        window.socket=socket
        window.start=config0=>{
            let config={
                userId:socket.id,
                useP2P:true,
                autoMove:1,
                render:false,
                renderURL:renderURL
            }
            if(config0)
                for(const tag in config0)
                    config[tag]=config0[tag]
            socket.emit('page2server',config)
        }
        window.start2=configList=>{
            socket.emit('page2server',configList)
        }
        socket.on('server2page',  data=> {
            const g=id=>{
                const value= getPreParam(id)==null  ?data[id]:getPreParam(id)
                return id+"="+value
            }
            location.href="http://"+data.renderURL+"/"
                +"?"+g("useP2P")
                +"&"+g("autoMove")
                +"&"+g("userId")
                +"&"+g("render")
                +"&backURL=http://"+location.host
        })
        socket.on("userCount",  data=> {
            console.log("userCount",data)
        })
    </script>
</head>
<body>
</body>
